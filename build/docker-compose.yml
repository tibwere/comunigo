version: "3.9"

services: 
  # Microservizio di registrazione
  registration_ms:
    build:
      context: ../
      dockerfile: ./build/dockerfiles/registration/Dockerfile
    environment: 
      - REG_PORT
      - SIZE
      - VERBOSE
      - SEQ_HOSTNAME
      - TOS
    volumes:
      - ../logs:/logs

  # Microservizio sequencer
  sequencer_ms:
    build:
      context: ../
      dockerfile: ./build/dockerfiles/sequencer/Dockerfile
    environment:
      - CHAT_PORT
      - REG_PORT
      - VERBOSE
      - SIZE
      - TOS
    volumes:
      - ../logs:/logs

  # Microservizio peer
  peer_ms:
    build:
      context: ../
      dockerfile: ./build/dockerfiles/peer/Dockerfile
    ports:
      - $WS_PORT
    environment: 
      - WS_PORT
      - REG_PORT
      - CHAT_PORT
      - SIZE
      - REG_HOSTNAME
      - SEQ_HOSTNAME
      - REDIS_HOSTNAME
      - VERBOSE
      - TOS
    depends_on: 
      - "peer_ds"
    volumes:
      - ../peer/webserver/assets:/assets:ro
      - ../logs:/logs

  peer_ds:
    image: "redis:alpine"